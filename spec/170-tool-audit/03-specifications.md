<!-- markdownlint-disable MD013 -->
# Specifications - Aggressive Tool Consolidation & Cleanup

**Reference**: Analysis in `spec/170-tool-audit/02-analysis.md`

## Executive Decision: BRUTAL ELIMINATION

This specification **DELETES REDUNDANT TOOLS IMMEDIATELY** with zero deprecation period. The current 85+ tool chaos is unacceptable and ends NOW.

**Version Impact**: Major version bump (v0.7.0) - clients WILL break and MUST adapt.

## Desired End State

1. **Single Source of Truth**: All tool metadata is auto-generated from MCP server introspection via `scripts/quilt_mcp_tools_list.py` - NO MANUAL MAINTENANCE.
2. **Eliminated Duplicates**: Aggressive consolidation removes 15+ redundant tools, keeping only the most capable implementation in each category.
3. **Auto-Generated Documentation**: `docs/api/TOOLS.md` is completely generated from code, preventing drift and ensuring accuracy.

## Scope & Boundaries

- **In Scope**: Complete removal of duplicate tools, auto-generation pipeline, breaking changes to `src/quilt_mcp/__init__.py`, replacement of manual CSV with generated metadata.
- **Out of Scope**: Maintaining compatibility with existing tool names - this is a clean break.

## Tool Consolidation Plan

### 1. Package Creation - DELETE DUPLICATES

**DELETE IMMEDIATELY:**

- `package_create` - GONE
- `create_package` - GONE
- `package_create_from_s3` - GONE

**SURVIVORS:**

- `create_package_enhanced` - The ONE package creation tool (renamed to `package_create`) [wraps the low-level quilt-service `create_package_revision`]
- `list_package_tools` - renamed to `package_tools_list`

**NO MIGRATION PERIOD** - Update your code or it breaks.

### 2. Search Functions - DELETE DUPLICATES

**DELETE IMMEDIATELY:**

- `packages_search` - GONE
- `bucket_objects_search` - GONE

**REFACTOR:**

- `package_contents_search` vs `unified_search` scope overlap - requires backend unification

**SURVIVOR:**

- `unified_search` - The ONE search tool (renamed to `catalog_search`)

**NO MIGRATION PERIOD** - Use unified_search or break.

### 3. URL Generation - KEEP BOTH FOR DIFFERENT PURPOSES

**SURVIVORS:**

- `catalog_url` - Web URLs for human browsing
- `catalog_uri` - Quilt+ URIs for QuiltSync integration (REQUIRED)

### 4. Tabulator Admin - DELETE INSECURE TOOLS

**DELETE IMMEDIATELY:**

- `tabulator_open_query_status` - GONE (no auth model)
- `tabulator_open_query_toggle` - GONE (no auth model)

**SURVIVORS:**

- `admin_tabulator_open_query_get` - Proper admin tool (renamed to `tabular_accessibility_get`)
- `admin_tabulator_open_query_set` - Proper admin tool (renamed to `tabular_accessibility_set`)

### 5. Metadata Templates - MINOR CONSOLIDATION

**KEEP BOTH** but clarify usage:

- `get_metadata_template` - raw template retrieval
- `create_metadata_from_template` - filled template with validation

NOTE: Rename all metadata tools to start with `metadata_` to allow alphabetical sorting.

### 6. Workflow Operations - RENAMING

**RENAME FOR ALPHABETICAL CLUSTERING:**

- `workflow_list_all` → `workflow_list`
- `workflow_add_step` → `workflow_step_add`
- `workflow_update_step` → `workflow_step_update`
- `workflow_get_status` → `workflow_status_get`

**RATIONALE**: Groups all workflow operations together alphabetically while maintaining semantic clarity.

## Auto-Generation Pipeline

### 0. Exports: `src/quilt_mcp/__init__.py`

Reorganize so tools appear alphabetically, to aid browsing.
The exception is admin tools (excluding tabulator), which appear at the end.

### 1. Script: `scripts/quilt_mcp_tools_list.py`

Implemented via a new 'tools-list' makefile target

**Purpose**: Introspect MCP server to extract authoritative tool metadata from `src/quilt_mcp/__init__.py` exports.

**Outputs**:

- `quilt_mcp_tools_canonical.csv` - replaces manual CSV
- `build/tools_metadata.json` - structured metadata for tooling
- `docs/api/TOOLS.md` - autogenerated via pydoc

**Integration**: Also runs in CI to verify no drift between code and documentation.

## Engineering Implementation

### 1. BRUTAL CODE DELETION

```python
# DELETE THESE IMPORTS from src/quilt_mcp/__init__.py
# from .tools.package_ops import package_create, package_update  # DELETED
# from .tools.unified_package import create_package  # DELETED
# from .tools.s3_package import package_create_from_s3  # DELETED

# DELETE FROM __all__ IMMEDIATELY
__all__ = [
    # ... existing tools ...
    # DELETED: "package_create", "create_package", "package_create_from_s3"
    # DELETED: "packages_search", "bucket_objects_search"
    # KEPT: "catalog_uri" (required for QuiltSync)
    # DELETED: "tabulator_open_query_status", "tabulator_open_query_toggle"
]
```

### 3. Make Targets

```makefile
# Add to Makefile
.PHONY: tools-list tools-check

tools-list:  ## Auto-generate tool listings from code
 python scripts/quilt_mcp_tools_list.py
 @echo "Generated canonical tool listings"

tools-check:  ## Validate tool listings match code
 python scripts/quilt_mcp_tools_list.py
 git diff --exit-code quilt_mcp_tools_canonical.csv docs/api/TOOLS.md
 @echo "Tool listings are synchronized"

lint: tools-check  ## Include tool validation in lint
```

## Success Criteria

1. **Zero Manual Maintenance**: Tool documentation generated entirely from code introspection.
2. **Elimination of Duplicates**: Reduced from 85 tools to ~70 tools through aggressive consolidation.
3. **Improved Developer Experience**: Single authoritative tool for each use case.
