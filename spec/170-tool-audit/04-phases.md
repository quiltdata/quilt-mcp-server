<!-- markdownlint-disable MD013 -->
# Phases - Aggressive Tool Consolidation & Cleanup

**Reference**: `spec/170-tool-audit/03-specifications.md`

## Phase Roadmap

1. **Phase 1 – Canonical Export Realignment**: Execute every mandated deletion and rename so `src/quilt_mcp/__init__.py` becomes the authoritative tool list that automation will consume.
2. **Phase 2 – Introspection & Generation Pipeline**: Build the scripts that introspect the curated exports and emit the canonical metadata artifacts.
3. **Phase 3 – Enforcement & Release Hardening**: Integrate the generators into developer workflows, replace legacy artifacts, and enforce drift prevention gates.

## Phase 1 – Canonical Export Realignment

**Objective**: Apply the "brutal elimination" plan in code, ensuring only the specified survivors remain, newly named, and alphabetically ordered.

**Deliverables**:

- **Deletions**: Purge `package_create`, `create_package`, `package_create_from_s3`, `packages_search`, `bucket_objects_search`, `tabulator_open_query_status`, and `tabulator_open_query_toggle` from `src/`, tests, fixtures, docs, and exports. Confirm no lingering references via `rg`.
- **Package Tool Renames**:
  - Promote `create_package_enhanced` to `package_create` (update function name, import/export wiring, docstrings, tests).
  - Rename `list_package_tools` to `package_tools_list` everywhere it appears.
- **Search Consolidation**: Rename `unified_search` implementation and export to `catalog_search`; remove competing search APIs and update call sites/fixtures.
- **Tabulator Admin Alignment**: Rename `admin_tabulator_open_query_get`/`set` to `tabular_accessibility_get`/`set` and adjust tests plus JSON fixtures.
- **Metadata Prefixing**: Rename metadata helpers to the `metadata_` namespace (`get_metadata_template` → `metadata_template_get`, `create_metadata_from_template` → `metadata_template_create`, plus any derivatives) and update references across code and docs.
- **Workflow Re-clustering**: Rename `workflow_list_all` → `workflow_list`, `workflow_add_step` → `workflow_step_add`, `workflow_update_step` → `workflow_step_update`, and `workflow_get_status` → `workflow_status_get`, syncing imports, tests, and documentation.
- **Export Ordering**: Reorder `__all__` alphabetically for public tools with admin-only tools grouped at the end; maintain consistent module import ordering.
- **Documentation Sync**: Update `docs/api/TOOLS.md` (temporary manual edit until Phase 2 automation) and any README snippets to reference the new names while removing deleted tools.

**Success Criteria**:

- `make test` and `make lint` pass with the new identifiers.
- `rg` over the repository returns zero matches for deleted tool names.
- `src/quilt_mcp/__init__.py` export list matches the survivor set and is alphabetized as mandated.

**Dependencies**:

- Ground truth for deletions/renames comes from `spec/170-tool-audit/03-specifications.md`; cross-check `02-analysis.md` to ensure all affected modules are touched.
- Coordinate timing of the intentional breaking changes (major version bump) with maintainers prior to merge.

**Prefactoring & Risk Mitigation**:

- Introduce helper aliases temporarily only if necessary to keep intermediate commits green while migrating tests; remove them before phase completion.
- Capture a mapping table of old→new tool names (e.g., comments or temporary markdown in `spec/`) to feed Phase 2 automation and migration notes.

**Testing & Integration Strategy**:

- Prefer `make test-unit` for rapid feedback during rename sweeps; run `make test` once all identifiers are migrated.
- Re-run integration suites that touch affected domains (package operations, tabulator admin, workflows) to validate behavior under new names.

## Phase 2 – Introspection & Generation Pipeline

**Objective**: Provide automated tooling that treats the curated export surface as the single source of truth and produces the canonical artifacts.

**Deliverables**:

- Implement `scripts/quilt_mcp_tools_list.py` that imports the server, inspects exported tools, and emits structured metadata.
- Generate `quilt_mcp_tools_canonical.csv`, `build/tools_metadata.json`, and a regenerated `docs/api/TOOLS.md` directly from script output.
- Supply utility modules (if needed) to normalize docstrings, categorize tools (public vs. admin), and format alphabetized output.
- Replace manual editing of the legacy `quilt_mcp_tools.csv` with the generated canonical CSV.

**Success Criteria**:

- Running the script after Phase 1 produces all three artifacts without manual editing, reflecting the renamed/deleted tool set.
- Generated CSV lists module, function, and description fields, alphabetized by tool name, and supersedes the manual CSV.
- Autogenerated `docs/api/TOOLS.md` passes markdown linting and aligns with the curated export order.

**Dependencies**:

- Requires Phase 1 completion for stable exports and name uniformity.
- Depends on consistent availability of descriptive metadata (docstrings or annotations) for every exported tool.

**Prefactoring & Risk Mitigation**:

- Where docstrings are missing or inconsistent, add them during this phase to ensure clean generation.
- Create golden-file or snapshot tests for the script output to prevent regressions when exports change.

**Testing & Integration Strategy**:

- Add Python tests that run the script in a temp directory and assert presence/ordering of key tools.
- Execute `make test` and targeted script tests locally and in CI to confirm deterministic output.

## Phase 3 – Enforcement & Release Hardening

**Objective**: Lock the automation into day-to-day workflows, eliminate stale manual artifacts, and communicate the breaking release.

**Deliverables**:

- Add Makefile targets `tools-list` and `tools-check` that run the script and verify artifacts match (per specification snippet), wiring `make lint` to depend on `tools-check`.
- Update documentation (`README`, `CLAUDE.md`, contributor guides) to explain the zero-maintenance tool catalog, how to regenerate artifacts, and the rename/deletion rationale.
- Remove or archive `quilt_mcp_tools.csv` in favor of `quilt_mcp_tools_canonical.csv`; ensure downstream consumers are pointed to the new file.
- Produce release artefacts: CHANGELOG entry for v0.7.0 (breaking release), version bump metadata, and migration guidance summarizing the old→new tool mapping.

**Success Criteria**:

- `make lint` (and CI lint jobs) fail when generated artifacts are stale, preventing drift.
- CI runs the new `tools-check` target, blocking merges if exports and artifacts diverge.
- Release documentation highlights the breaking changes and references the canonical automation outputs.

**Dependencies**:

- Requires Phase 2 tooling to be stable and idempotent.
- Needs coordination with release owners for scheduling the major version bump and notifying consumers.

**Prefactoring & Risk Mitigation**:

- Ensure generated artifacts are ignored or cleaned via existing `make clean` targets to avoid dirty working trees.
- Provide contributor quick-start instructions to minimize friction when running new targets.

**Testing & Integration Strategy**:

- Run the full validation suite (`make test`, `make lint`, `make coverage`) after wiring enforcement gates.
- Monitor initial CI runs to confirm deterministic behavior of the generation and enforcement steps.
